<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
<khip:khiprocess
        xmlns:khip="http://www.example.com/beetlekhi/process"
        xmlns:khic="http://www.example.com/beetlekhi/command"
        name="Stupid Salted Water Process">
    <khip:Nodes>
        <khip:Node name="NaOH_syringe">
            <khip:module>mSyringeByAlexandre</khip:module>
            <khip:I2Caddress>1</khip:I2Caddress>
        </khip:Node>
        <khip:Node name="HCl_syringe">
            <khip:module>mSyringeByAlexandre</khip:module>
            <khip:I2Caddress>2</khip:I2Caddress>
        </khip:Node>
        <khip:Node name="TheReactor">
            <khip:module>mReactorByBernard</khip:module>
            <khip:I2Caddress>3</khip:I2Caddress>
        </khip:Node>
    </khip:Nodes>
    <khip:plan>
        <khip:initial>khi_setup</khip:initial>
        <khip:operations>
            <!-- Set State to RUN-->
            <khip:operation name="khi_setup">
                <khip:triggers>
                    <khip:trigger name="khi_setup_wait">
                        <khip:nextOperation>setup_HCl</khip:nextOperation>
                        <khip:eventListenersLogicalAnd>
                            <khip:timer name="khi_setup_wait_timer">5</khip:timer>
                        </khip:eventListenersLogicalAnd>
                    </khip:trigger>
                </khip:triggers>
            </khip:operation>
            <khip:operation name="setup_HCl">
                <khip:executeCommand name="MOVE_TO_UPPER_STOP" node="HCl_syringe"/>
                <khip:triggers>
                    <khip:trigger>
                        <khip:nextOperation>send_HCl</khip:nextOperation>
                        <khip:eventListenersLogicalAnd>
                            <khip:eventListener name="wait_for_upper_op" event="UPPER_STOP" node="HCl_syringe"/>
                        </khip:eventListenersLogicalAnd>
                    </khip:trigger>
                    <khip:errors>
                        <khip:error name="unexpected_stop" event="UNEXPECTED_STOP" node="HCl_syringe"/>
                    </khip:errors>
                </khip:triggers>
            </khip:operation>
            <khip:operation name="send_HCl">
                <khip:executeCommand name="inject" node="HCl_syringe">
                    <khic:attributes>
                        <khic:attribute name="volume">80</khic:attribute>
                        <khic:attribute name="flowRate">30</khic:attribute>
                    </khic:attributes>
                </khip:executeCommand>
                <khip:triggers>
                    <khip:trigger>
                        <khip:nextOperation>send_NaOH</khip:nextOperation>
                        <khip:eventListenersLogicalAnd>
                            <khip:eventListener name="send_hcl_ok" node="HCl_syringe" event="DONE"/>
                        </khip:eventListenersLogicalAnd>
                    </khip:trigger>
                    <khip:errors>
                        <khip:error name="setup_error" node="HCl_syringe" event="UNEXPECTED_STOP"/>
                    </khip:errors>
                </khip:triggers>
            </khip:operation>
            <khip:operation name="send_NaOH">
                <khip:executeCommand name="inject" node="NaOH_syringe">
                    <khic:attributes>
                        <khic:attribute name="volume">20</khic:attribute>
                        <khic:attribute name="flowRate">30</khic:attribute>
                    </khic:attributes>
                </khip:executeCommand>
                <khip:triggers>
                    <khip:trigger>
                        <khip:nextOperation>react</khip:nextOperation>
                        <khip:eventListenersLogicalAnd>
                            <khip:eventListener name="setup_naoh_ok" node="NaOH_syringe" event="DONE"/>
                        </khip:eventListenersLogicalAnd>
                    </khip:trigger>
                </khip:triggers>
            </khip:operation>
            <khip:operation name="react">
                <khip:executeCommand name="setTemperature" node="TheReactor">
                    <khic:attributes>
                        <khic:attribute name="temp" type="double">120.0</khic:attribute>
                    </khic:attributes>
                </khip:executeCommand>
            </khip:operation>
        </khip:operations>
    </khip:plan>
</khip:khiprocess>