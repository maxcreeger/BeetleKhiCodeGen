<?xml version="1.0" encoding="UTF-8" standalone="no" ?>
<khimodule name="mSyringeByAlexandre">
	<code>
		<libraries>
			<libary name="stepperLib">Stepper.h</libary>
		</libraries>
		<stateVariables>
			<stateVariable name="bLowerLimit" type="boolean"/>
			<stateVariable name="bUpperLimit" type="boolean"/>
			<stateVariable name="iCurrentVolume" type="int"/>
		</stateVariables>
		<setup><![CDATA[
	//Set interruptions

	pinMode(iLowerLimitSwitch_pin, INPUT);//Lower Limit Detection
	attachInterrupt(digitalPinToInterrupt(iLowerLimitSwitch_pin), LowerLimitSwitchISR, CHANGE);

	pinMode(iUpperLimitSwitch_pin, INPUT);//Upper Limit Detection
	attachInterrupt(digitalPinToInterrupt(iUpperLimitSwitch_pin), UpperLimitSwitchISR, CHANGE);
]]>
		</setup>
		<loop><![CDATA[
	double vitT = (temp - temp_old) /0.01;
	double cmd = P*(temp - target) + D * vitT;
	sendCurrent(cmd);
]]>
		</loop>
		<internal><![CDATA[
//Interrupt Service Routine
void LowerLimitSwitchISR() {
	bLowerLimit = digitalRead(iLowerLimitSwitch_pin);
}

//Interrupt Service Routine
void UpperLimitSwitchISR() {
	bUpperLimit =  digitalRead(iUpperLimitSwitch_pin);
}
]]>
		</internal>
		<methods>
			<method name = "sendCurrent"><![CDATA[
	printf("hello world?");
]]>
			</method>
			<method name = "inject"><![CDATA[
	printf("hello world !!!!");
]]>
			</method>
		</methods>
	</code>
	<communication>
		<commands>
			<command name="inject" keyword="PUMP">
				<attributes>
					<attribute name="volume"   type="long" signed="true"  length="9">iTargetVolume</attribute>
					<attribute name="flowRate" type="int"  signed="false" length="6">iFlowRate</attribute>
				</attributes>
				<timeout>10000</timeout>
			</command>
			<command name="MOVE_TO_LOWER_STOP" keyword="MOVE_TO_LOWER_STOP">
				<attributes>
					<attribute name="yesOrNo"   type="boolean" length="5">bMoveToLowerLimit</attribute>
				</attributes>
			</command>
			<command name="MOVE_TO_UPPER_STOP" keyword="MOVE_TO_UPPER_STOP">
				<attributes>
					<attribute name="yesOrNo"   type="boolean" length="5">bMoveToUpperLimit</attribute>
				</attributes>
			</command>
		</commands>
		<sensors>
			<sensor name="VOLUME">
				<attributes>
					<attribute name="VALUE" type="double"/>
				</attributes>
				<variableReference name="iCurrentVolume"/>
			</sensor>
			<sensor name="UPPER_STOP">
				<attributes>
					<attribute name="VALUE" type="boolean"/>
				</attributes>
				<variableReference name="bUpperLimit"/>
			</sensor>
			<sensor name="LOWER_STOP">
				<attributes>
					<attribute name="VALUE" type="boolean"/>
				</attributes>
				<variableReference name="bLowerLimit"/>
			</sensor>
		</sensors>
		<events>
			<event name="LOWER_STOP"/>
			<event name="UPPER_STOP"/>
			<event name="DONE"/>
			<event name="UNEXPECTED_STOP"/>
		</events>
	</communication>
	<hardware>
		<fluidConnections>
			<fluidConnection direction="BOTH" name="fluidExit"/>
		</fluidConnections>
	</hardware>
</khimodule>